<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SQL Playground</title>
  <style>
    :root { --border:#e5e7eb; --muted:#6b7280; --ok:#16a34a; --warn:#dc2626; }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; color:#111; }
    header { padding: 16px 20px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center; }
    header h1 { margin:0; font-size:18px; }
    #status { color: var(--muted); font-size:14px; }
    main { display:grid; grid-template-columns: 360px 1fr; gap: 16px; padding:16px; }
    @media (max-width: 900px) { main { grid-template-columns: 1fr; } }
    .panel { border:1px solid var(--border); border-radius:12px; background:#fff; min-height:200px; }
    .panel .pad { padding:16px; }
    .panel h2 { margin:0 0 8px; font-size:16px; }
    .muted { color: var(--muted); }
    textarea { width:100%; min-height:260px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; border:1px solid var(--border); border-radius:10px; padding:10px; }
    .toolbar { display:flex; flex-wrap:wrap; gap:8px; align-items:center; margin-top:8px; }
    button { padding:8px 12px; border-radius:10px; border:1px solid #cfcfcf; background:#fff; cursor:pointer; }
    button.primary { background:#111; color:#fff; border-color:#111; }
    button:disabled { opacity:.5; cursor:not-allowed; }
    #results { margin-top:12px; border:1px solid var(--border); border-radius:10px; padding:10px; min-height:52px; }
    table { border-collapse:collapse; width:100%; }
    th,td { border:1px solid var(--border); padding:6px 8px; text-align:left; }
    th { background:#f9fafb; }
    .ok { color:var(--ok); font-weight:600; }
    .warn { color:var(--warn); font-weight:600; }
  </style>
</head>
<body>
  <header>
    <h1>SQL Playground</h1>
    <div id="status" class="muted">Loading SQL engine…</div>
  </header>

  <main>
    <!-- LEFT: placeholder only (we'll add problems/schema later) -->
    <section class="panel">
      <div class="pad">
        <h2>Workspace</h2>
        <p class="muted">This panel is for problem text / schema later. For now, just use the editor on the right.</p>
        <ul class="muted" style="margin-top:8px; padding-left:18px;">
          <li>Two-pane layout is ready</li>
          <li>Editor + Run works</li>
          <li>Reset DB restores seed data</li>
        </ul>
      </div>
    </section>

    <!-- RIGHT: editor + run/results -->
    <section class="panel">
      <div class="pad">
        <h2>Editor</h2>
        <textarea id="editor">-- Try it: returns all products
SELECT product_id, name, price
FROM products
ORDER BY product_id;</textarea>

        <div class="toolbar">
          <button id="run" class="primary" disabled title="Ctrl/Cmd + Enter">Run</button>
          <button id="reset" disabled>Reset DB</button>
          <span id="run-info" class="muted"></span>
        </div>

        <div id="results" class="muted">Run a query to see results here.</div>
      </div>
    </section>
  </main>

  <!-- sql.js (SQLite in the browser) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.js"></script>
  <script>
    // Minimal seed so users can run something immediately
    const SEED_SQL = `
CREATE TABLE products (
  product_id INTEGER PRIMARY KEY,
  name TEXT,
  price REAL
);
INSERT INTO products VALUES
  (1,'Headphones',79.00),
  (2,'Keyboard',59.00),
  (3,'Kettle',39.00);
`;

    let SQL, db;
    const els = {
      status: document.getElementById('status'),
      editor: document.getElementById('editor'),
      run: document.getElementById('run'),
      reset: document.getElementById('reset'),
      runInfo: document.getElementById('run-info'),
      results: document.getElementById('results')
    };

    function setReady(on) {
      els.run.disabled = !on;
      els.reset.disabled = !on;
      els.status.textContent = on ? 'Ready' : 'Loading SQL engine…';
      els.status.className = on ? 'muted' : 'muted';
    }

    function render(result) {
      if (!result || !result.columns) {
        els.results.innerHTML = '<span class="muted">No rows.</span>';
        return;
      }
      const { columns, values } = result;
      let html = '<table><thead><tr>' + columns.map(c=>`<th>${c}</th>`).join('') + '</tr></thead><tbody>';
      for (const row of values) html += '<tr>' + row.map(v=>`<td>${v===null?'<i>null</i>':String(v)}</td>`).join('') + '</tr>';
      html += '</tbody></table>';
      els.results.innerHTML = html;
    }

    async function boot() {
      try {
        setReady(false);
        SQL = await initSqlJs({ locateFile: f => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/${f}` });
        db = new SQL.Database();
        db.run(SEED_SQL);
        // show initial table quickly
        const res = db.exec('SELECT * FROM products');
        if (res.length) { els.results.classList.remove('muted'); render(res[0]); }
        setReady(true);
      } catch (e) {
        els.status.textContent = 'Failed to load SQL engine: ' + e.message;
        els.status.className = 'warn';
      }
    }

    function runQuery() {
      if (!db) { els.results.innerHTML = '<span class="warn">DB not ready.</span>'; return; }
      const sql = els.editor.value.trim();
      els.runInfo.textContent = 'Running…';
      const t0 = performance.now();
      try {
        const results = db.exec(sql);
        const ms = Math.max(1, Math.round(performance.now() - t0));
        if (!results.length) {
          els.results.innerHTML = '<span class="muted">Query OK (no rows)</span>';
          els.runInfo.textContent = `Time: ${ms} ms`;
        } else {
          render(results[0]);
          const rows = results[0].values.length;
          els.runInfo.textContent = `Rows: ${rows} • Time: ${ms} ms`;
        }
      } catch (e) {
        els.results.innerHTML = '<span class="warn">' + e.message + '</span>';
        els.runInfo.textContent = '';
      }
    }

    function resetDB() {
      db = new SQL.Database();
      db.run(SEED_SQL);
      const res = db.exec('SELECT * FROM products');
      els.results.classList.remove('muted');
      render(res[0]);
      els.runInfo.textContent = 'DB reset';
    }

    // wire events
    document.getElementById('run').addEventListener('click', runQuery);
    document.getElementById('reset').addEventListener('click', resetDB);
    document.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') runQuery();
    });

    // start
    boot();
  </script>
</body>
</html>
